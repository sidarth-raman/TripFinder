<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WayNodes.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TripFinder</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs.mramesh4.maps</a> &gt; <span class="el_source">WayNodes.java</span></div><h1>WayNodes.java</h1><pre class="source lang-java linenums">package edu.brown.cs.mramesh4.maps;

import edu.brown.cs.mramesh4.Dimensional.Dimensional;
import edu.brown.cs.mramesh4.Graph.GraphNode;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

/**
 * This class represents a Node object from the database. It implements
 * GraphNode so that it can be used in our generic Graph class.
 */
public class WayNodes implements Dimensional, GraphNode&lt;WayNodes, Way&gt; {

  private final String id;
  private final double lat;
  private final double longitude;
  private static final double EARTH_RADIUS_IN_KM = 6371;
  private transient Way from;
  private transient double distance;
  private transient double weight;
  private static final double MIN_LNG = -180;
  private static final double MAX_LNG = 180;
  private transient Connection conn;

  /**
   * This is a constructor for a wayNode, it takes in the following information
   * and initializes all of our instance variables. We also calculate the
   * real longitutde.
   * @param id a String representing an id
   * @param lat a double representing latitude
   * @param longit a double representing longitude
   * @param conn representing a connection to the current database
   */
<span class="nc" id="L38">  public WayNodes(String id, double lat, double longit, Connection conn) {</span>
<span class="nc" id="L39">    this.id = id;</span>
<span class="nc" id="L40">    this.lat = lat;</span>
<span class="nc" id="L41">    this.longitude = longit;</span>
    //doesn't have a from Way at first
<span class="nc" id="L43">    this.from = null;</span>
<span class="nc" id="L44">    this.distance = Double.MAX_VALUE;</span>
<span class="nc" id="L45">    this.weight = Double.MAX_VALUE;</span>
<span class="nc" id="L46">    this.conn = conn;</span>
<span class="nc" id="L47">  }</span>


  /**
   * Gets the specific coordinate on a given pair.
   * @param index the int index
   * @return a double representing the current coordinate
   */
  public double getCoordinate(int index) {
<span class="nc bnc" id="L56" title="All 2 branches missed.">    if (index == 0) {</span>
<span class="nc" id="L57">      return this.longitude;</span>
    } else {
<span class="nc" id="L59">      return this.lat;</span>
    }
  }

  /**
   * Returns number of coordinates to consider.
   * @return 2, representing number of dimensions
   */
  public int numDimensions() {
<span class="nc" id="L68">    return 2;</span>
  }

  /**
   * Gets the distance between two WayNode objects.
   * @param a the waynode object to compare distance with
   * @return double representing euclidean distance between the two objects
   */
  public double distanceBetween(Dimensional a) {
<span class="nc bnc" id="L77" title="All 2 branches missed.">    if (a instanceof WayNodes) {</span>
<span class="nc" id="L78">      double aX = a.getCoordinate(0);</span>
<span class="nc" id="L79">      double aY = a.getCoordinate(1);</span>
<span class="nc" id="L80">      return Math.sqrt(Math.pow(Math.abs((aX - this.longitude)), 2)</span>
<span class="nc" id="L81">        + Math.pow(Math.abs((aY - this.lat)), 2));</span>
    } else {
<span class="nc" id="L83">      return -1;</span>
    }
  }

  /**
   * Fufills dimensional interface, gets the distance at a specific coordinate.
   * @param dimension A dimension to check
   * @param a the object to compare with
   * @return a double along the axis
   */
  public double getAxisDistance(int dimension, Dimensional a) {
<span class="nc" id="L94">    return this.getCoordinate(dimension) - a.getCoordinate(dimension);</span>
  }

  /**
   * A parameter of information to check.
   * @param a representing an optional query of which string to return.
   * @return the id string, the only information we need to know
   */
  public String getInfo(String a) {
<span class="nc" id="L103">    return this.id;</span>
  }

  /**
   * An accessor method for id.
   * @return String representing id
   */
  public String getId() {
<span class="nc" id="L111">    return this.id;</span>
  }

  /**
   * An accessor method for Latitude.
   * @return double representing latitude
   */
  public double getLat() {
<span class="nc" id="L119">    return this.lat;</span>
  }

  /**
   * An accessor method for Longitude.
   * @return double representing longitude;
   */
  public double getLong() {
<span class="nc" id="L127">    return this.longitude;</span>
  }


  /**
   * An accessor for the from Way.
   * @return a Way representing from Way
   */
  @Override
  public Way getFrom() {
<span class="nc" id="L137">    return from;</span>
  }

  /**
   * A setter method to set the from edge.
   * @param e representing Way to set as from
   */
  @Override
  public void setFrom(Way e) {
<span class="nc" id="L146">    from = e;</span>
<span class="nc" id="L147">  }</span>

  /**
   * Setter for distance from startNode in graph.
   * @param d a double representing distance
   */
  @Override
  public void setCurrentDistance(double d) {
<span class="nc" id="L155">    distance = d;</span>
<span class="nc" id="L156">  }</span>

  /**
   * Getter for distance from startNode in graph.
   * @return double representing distance.
   */
  @Override
  public double getCurrentDistance() {
<span class="nc" id="L164">    return distance;</span>
  }

  /**
   * This method checks if two WayNodes are equal by checking
   * if the ID's are equal, since all IDS are guaranteed to be unique.
   * @param n representing the WayNode to compare
   * @return a boolean representing if the Nodes are equal (true if equal)
   */
  @Override
  public boolean equals(WayNodes n) {
<span class="nc" id="L175">    return this.id.equals(n.getId());</span>
  }

  /**
   * This method returns the name of the WayNode, which is the ID.
   * @return String representing the ID of the current WayNode
   */
  @Override
  public String getName() {
<span class="nc" id="L184">    return this.id;</span>
  }

  /**
   * This method returns a list of WayNodes that are neighbors of the
   * current Node. We find these neighbors by querying the database.
   * @return a List of WayNodes representing the neighbors.
   */
  @Override
  public List&lt;WayNodes&gt; neighbors() {
    try {
      PreparedStatement prep;
      //don't want to return Nodes that we can't reach (untraversable)
<span class="nc" id="L197">      prep = conn.prepareStatement(&quot;SELECT * FROM node AS n JOIN way AS w WHERE w.start == ? &quot;</span>
              + &quot;AND (w.type != 'unclassified' AND w.type != '')  AND n.id == w.end&quot;);
<span class="nc" id="L199">      prep.setString(1, this.id);</span>
<span class="nc" id="L200">      ResultSet rs = prep.executeQuery();</span>
<span class="nc" id="L201">      List&lt;WayNodes&gt; ret = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">      while (rs.next()) {</span>
<span class="nc" id="L203">        String idNext = rs.getString(1);</span>
<span class="nc" id="L204">        double latitudeNext = rs.getDouble(2);</span>
<span class="nc" id="L205">        double longitudeNext = rs.getDouble(3);</span>
        //instantiate the neighbors as WayNodes here
<span class="nc" id="L207">        WayNodes next = new WayNodes(idNext, latitudeNext, longitudeNext, this.conn);</span>
        //instantiate the edges connecting neighbors so we can set the from value of neighbors
<span class="nc" id="L209">        Way edge = new Way(rs.getString(4), this, next, rs.getString(&quot;type&quot;));</span>
<span class="nc" id="L210">        next.setFrom(edge);</span>
<span class="nc" id="L211">        ret.add(next);</span>
<span class="nc" id="L212">      }</span>
<span class="nc" id="L213">      return ret;</span>
<span class="nc" id="L214">    } catch (SQLException e) {</span>
<span class="nc" id="L215">      System.err.println(&quot;ERROR: Error querying the database with SQL&quot;);</span>
<span class="nc" id="L216">      return null;</span>
    }
  }

  /**
   * This getter method returns the total weight of Node.
   * @return double representing weight
   */
  @Override
  public double getTotalWeight() {
<span class="nc" id="L226">    return weight;</span>
  }

  /**
   * This setter method sets the total weight of Node.
   * @param weightArg representing weight to set
   */
  @Override
  public void setTotalWeight(double weightArg) {
<span class="nc" id="L235">    weight = weightArg;</span>
<span class="nc" id="L236">  }</span>

  /**
   * This method calculates the distance to the goal using Haversine distance.
   * @param goal representing goal node
   * @return double representing distance.
   */
  @Override
  public double toGoal(WayNodes goal) {
<span class="nc" id="L245">    double thisLat = Math.toRadians(lat);</span>
<span class="nc" id="L246">    double thisLon = Math.toRadians(longitude);</span>
<span class="nc" id="L247">    double goalLat = Math.toRadians(goal.getLat());</span>
<span class="nc" id="L248">    double goalLon = Math.toRadians(goal.getLong());</span>
    /**
     * Haversine formula: I got this from
     * https://www.geeksforgeeks.org/program-distance-two-points-earth/
     */
<span class="nc" id="L253">    double dlon = goalLon - thisLon;</span>
<span class="nc" id="L254">    double dlat = goalLat - thisLat;</span>
<span class="nc" id="L255">    double havernmath = Math.pow(Math.sin(dlat / 2), 2)</span>
<span class="nc" id="L256">            + Math.cos(thisLat) * Math.cos(goalLat)</span>
<span class="nc" id="L257">            * Math.pow(Math.sin(dlon / 2), 2);</span>
<span class="nc" id="L258">    double finalanswer = 2 * Math.asin(Math.sqrt(havernmath));</span>
    // Radius of earth in kilometers. Use 3956 for miles
<span class="nc" id="L260">    return (finalanswer * EARTH_RADIUS_IN_KM);</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>