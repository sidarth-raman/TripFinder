<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GUIHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">TripFinder</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs.mramesh4.maps</a> &gt; <span class="el_source">GUIHandler.java</span></div><h1>GUIHandler.java</h1><pre class="source lang-java linenums">package edu.brown.cs.mramesh4.maps;
import com.google.common.collect.ImmutableMap;
import com.google.gson.Gson;
import edu.brown.cs.mramesh4.SQLDatabase.UserSQLDatabase;
import edu.brown.cs.mramesh4.stars.Star;
import edu.brown.cs.mramesh4.stars.StarsLogic;
import org.json.JSONObject;

import spark.ModelAndView;
import spark.QueryParamsMap;
import spark.Request;
import spark.Response;
import spark.Route;
import spark.TemplateViewRoute;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

/**
 * This is a class for a GUIHandler.
 */
public class GUIHandler {
  private static MapsLogic map;
<span class="nc" id="L25">  private static final Gson GSON = new Gson();</span>
  private static UserSQLDatabase database;
  private static StarsLogic db;
  private static CheckinThread ct;

  /**
   * This is the constructor for the handler. It takes in all the pre-req info.
   * @param databases database class
   * @param maps mapsLogic class
   * @param star starsLogic class
   * @param c checkinThread instance
   */
<span class="nc" id="L37">  public GUIHandler(UserSQLDatabase databases, MapsLogic maps, StarsLogic star, CheckinThread c) {</span>
<span class="nc" id="L38">    database = databases;</span>
<span class="nc" id="L39">    map = maps;</span>
<span class="nc" id="L40">    db = star;</span>
<span class="nc" id="L41">    ct = c;</span>
<span class="nc" id="L42">  }</span>

  /**
   * This is a GuiHandler method used to run route methods.
   * @param call name of method to run
   * @return a handler
   */
  public Route method(String call) {
<span class="nc" id="L50">    Route c = null;</span>
<span class="nc bnc" id="L51" title="All 7 branches missed.">    switch (call) {</span>
      case &quot;UserHandler&quot;:
<span class="nc" id="L53">        c =  new UserHandler();</span>
<span class="nc" id="L54">        break;</span>
      case &quot;WayHandler&quot;:
<span class="nc" id="L56">        c = new WayHandler();</span>
<span class="nc" id="L57">        break;</span>
      case &quot;RouteCoorsHandler&quot;:
<span class="nc" id="L59">        c = new RouteCoorsHandler();</span>
<span class="nc" id="L60">        break;</span>
      case &quot;NearestHandler&quot;:
<span class="nc" id="L62">        c = new NearestHandler();</span>
<span class="nc" id="L63">        break;</span>
      case &quot;RouteStreetsHandler&quot;:
<span class="nc" id="L65">        c = new RouteStreetsHandler();</span>
<span class="nc" id="L66">        break;</span>
      case &quot;CheckInHandler&quot;:
<span class="nc" id="L68">        c = new CheckInHandler();</span>
<span class="nc" id="L69">        break;</span>
      default:
<span class="nc" id="L71">        c = null;</span>
        break;
    }
<span class="nc" id="L74">    return c;</span>
  }

  /**
   * Handler to handle checkins.
   */
  private static class CheckInHandler implements Route {
    @Override
    public Object handle(Request request, Response response) throws Exception {
<span class="nc" id="L83">      Map&lt;Double, UserCheckin&gt; ret = ct.getLatestCheckins();</span>
<span class="nc" id="L84">      Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;users&quot;, ret);</span>
<span class="nc" id="L85">      return GSON.toJson(variables);</span>
    }
  }

  /**
   * method to handle template view routes.
   * @param call a method to run
   * @return a handler for that method
   */
  public TemplateViewRoute methodTVR(String call) {
<span class="nc" id="L95">    TemplateViewRoute c = null;</span>
<span class="nc bnc" id="L96" title="All 4 branches missed.">    switch (call) {</span>
      case &quot;NeighborsHandler&quot;:
<span class="nc" id="L98">        c =  new NeighborsHandler();</span>
<span class="nc" id="L99">        break;</span>
      case &quot;RadiusHandler&quot;:
<span class="nc" id="L101">        c = new RadiusHandler();</span>
<span class="nc" id="L102">        break;</span>
      case &quot;FrontHandler&quot;:
<span class="nc" id="L104">        c = new FrontHandler();</span>
<span class="nc" id="L105">        break;</span>
      default:
<span class="nc" id="L107">        c = null;</span>
        break;
    }
<span class="nc" id="L110">    return c;</span>
  }

  /**
   * This is a handler to handle getting users from the database.
   */
  private static class UserHandler implements Route {
    @Override
    public Object handle(Request request, Response response) throws Exception {
<span class="nc" id="L119">      JSONObject data = new JSONObject(request.body());</span>
<span class="nc" id="L120">      String user = data.getString(&quot;userid&quot;);</span>
<span class="nc" id="L121">      List&lt;UserCheckin&gt; ret = database.getUserInfo(user);</span>
<span class="nc" id="L122">      Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;user&quot;, ret);</span>
<span class="nc" id="L123">      return GSON.toJson(variables);</span>

    }
  }

  /**
   * Handle requests to the front page of our Stars website.
   *
   */
  private static class FrontHandler implements TemplateViewRoute {
    @Override
    public ModelAndView handle(Request req, Response res) {
<span class="nc" id="L135">      String ret = &quot;No results to display&quot;;</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">      if (db.getStarList().size() == 0) {</span>
<span class="nc" id="L137">        ret = &quot;Please load a file in the command line&quot;;</span>
      }
<span class="nc" id="L139">      Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;title&quot;,</span>
          &quot;Stars: Query the database&quot;, &quot;results&quot;, ret);
<span class="nc" id="L141">      return new ModelAndView(variables, &quot;query.ftl&quot;);</span>
    }
  }

  /**
   * This is a handler to get all the ways within a route.
   */
  private static class WayHandler implements Route {
    @Override
    public Object handle(Request request, Response response) throws Exception {
<span class="nc" id="L151">      JSONObject data = new JSONObject(request.body());</span>
<span class="nc" id="L152">      double sLat = data.getDouble(&quot;lat1&quot;);</span>
<span class="nc" id="L153">      double sLon = data.getDouble(&quot;long1&quot;);</span>
<span class="nc" id="L154">      double dLat = data.getDouble(&quot;lat2&quot;);</span>
<span class="nc" id="L155">      double dLon = data.getDouble(&quot;long2&quot;);</span>
<span class="nc" id="L156">      String[] com = new String[]{&quot;ways&quot;, Double.toString(sLat), Double.toString(sLon),</span>
<span class="nc" id="L157">        Double.toString(dLat), Double.toString(dLon)};</span>
<span class="nc" id="L158">      System.out.println(com[0] + com[1] + com[2] + com[3] + com[4]);</span>
<span class="nc" id="L159">      List&lt;Way&gt; ret = map.ways(com);</span>
<span class="nc" id="L160">      Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;ways&quot;, ret);</span>
<span class="nc" id="L161">      return GSON.toJson(variables);</span>
    }
  }


  /**
   * Handles requests made for a route.
   */
  private static class RouteCoorsHandler implements Route {
    @Override
    public Object handle(Request request, Response response) {
      try {
<span class="nc" id="L173">        JSONObject data = new JSONObject(request.body());</span>
<span class="nc" id="L174">        double sLat = data.getDouble(&quot;srclat&quot;);</span>
<span class="nc" id="L175">        double sLon = data.getDouble(&quot;srclong&quot;);</span>
<span class="nc" id="L176">        double dLat = data.getDouble(&quot;destlat&quot;);</span>
<span class="nc" id="L177">        double dLon = data.getDouble(&quot;destlong&quot;);</span>

<span class="nc" id="L179">        String[] com = new String[]{&quot;route&quot;, Double.toString(sLat), Double.toString(sLon),</span>
<span class="nc" id="L180">          Double.toString(dLat), Double.toString(dLon)};</span>
<span class="nc" id="L181">        List&lt;WayNodes&gt; coordinates = map.routeRet(com);</span>
<span class="nc" id="L182">        Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;routeCoors&quot;, coordinates);</span>
<span class="nc" id="L183">        return GSON.toJson(variables);</span>

<span class="nc" id="L185">      } catch (Exception e) {</span>
<span class="nc" id="L186">        Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;routeCoors&quot;, new ArrayList&lt;&gt;());</span>
<span class="nc" id="L187">        return GSON.toJson(variables);</span>
      }

    }
  }


  /**
   * Handles requests made for a route.
   */

  private static class RouteStreetsHandler implements Route {
    @Override
    public Object handle(Request request, Response response) throws Exception {
<span class="nc" id="L201">      JSONObject data = new JSONObject(request.body());</span>
<span class="nc" id="L202">      String street1 = data.getString(&quot;street1&quot;);</span>
<span class="nc" id="L203">      String cross1 = data.getString(&quot;cross1&quot;);</span>
<span class="nc" id="L204">      String street2 = data.getString(&quot;street2&quot;);</span>
<span class="nc" id="L205">      String cross2 = data.getString(&quot;cross2&quot;);</span>
<span class="nc" id="L206">      String[] com = new String[]{&quot;route&quot;, street1, cross1, street2, cross2};</span>
<span class="nc" id="L207">      List&lt;WayNodes&gt; coordinates = map.routeRet(com);</span>
<span class="nc" id="L208">      Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;routeStreets&quot;, coordinates);</span>
<span class="nc" id="L209">      return GSON.toJson(variables);</span>
    }
  }


  /**
   * Gets the nearest node.
   */
  private static class NearestHandler implements Route {
    @Override
    public Object handle(Request request, Response response) throws Exception {
<span class="nc" id="L220">      JSONObject data = new JSONObject(request.body());</span>
<span class="nc" id="L221">      double sLat = data.getDouble(&quot;lat&quot;);</span>
<span class="nc" id="L222">      double sLon = data.getDouble(&quot;long&quot;);</span>
<span class="nc" id="L223">      String[] com = new String[]{&quot;nearest&quot;, Double.toString(sLat), Double.toString(sLon)};</span>
<span class="nc" id="L224">      WayNodes node = map.nearest(com);</span>
<span class="nc" id="L225">      Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;nearest&quot;, node);</span>
<span class="nc" id="L226">      return GSON.toJson(variables);</span>
    }
  }


  /**
   * Handles the radius call on the gui.
   */
  private static class RadiusHandler implements TemplateViewRoute {
    @Override
    public ModelAndView handle(Request req, Response res) {
<span class="nc" id="L237">      QueryParamsMap qm = req.queryMap();</span>
<span class="nc" id="L238">      String cmd = qm.value(&quot;text2&quot;);</span>
<span class="nc" id="L239">      String ret = &quot;No results to display&quot;;</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">      if (db.getStarList().size() == 0) {</span>
<span class="nc" id="L241">        ret = &quot;Please load a file in the command line&quot;;</span>
<span class="nc bnc" id="L242" title="All 4 branches missed.">      } else if (cmd == null || cmd.equals(&quot;&quot;)) {</span>
<span class="nc" id="L243">        ret = &quot;Please input a valid answer&quot;;</span>
      } else {
<span class="nc" id="L245">        String neighbs = qm.value(&quot;radius_switched&quot;);</span>
<span class="nc" id="L246">        String start = &quot;naive_radius&quot;;</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">        if (neighbs != null) {</span>
<span class="nc" id="L248">          start = &quot;radius&quot;;</span>
        }
<span class="nc" id="L250">        String cmd2 = start.concat(&quot; &quot;).concat(cmd);</span>
<span class="nc" id="L251">        String[] coms = cmd2.split(&quot; &quot;);</span>
<span class="nc" id="L252">        List&lt;Star&gt; stars = db.radiusRet(cmd2, coms);</span>

<span class="nc bnc" id="L254" title="All 2 branches missed.">        if (db.getStarList().size() == 0) {</span>
<span class="nc" id="L255">          ret = &quot;Please load a file in the command line&quot;;</span>
        }
<span class="nc bnc" id="L257" title="All 2 branches missed.">        if (coms[0].toUpperCase().equals(&quot;NAIVE_NEIGHBORS&quot;)</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">            || coms[0].toUpperCase().equals(&quot;NEIGHBORS&quot;)) {</span>
<span class="nc" id="L259">          ret = &quot;Please use the neighbors box for this action&quot;;</span>
        } else {
<span class="nc bnc" id="L261" title="All 2 branches missed.">          if (db.getStarList().size() == 0) {</span>
<span class="nc" id="L262">            ret = &quot;Please load a file in the command line&quot;;</span>
          }
<span class="nc bnc" id="L264" title="All 4 branches missed.">          if (stars != null &amp;&amp; !stars.isEmpty()) {</span>
<span class="nc" id="L265">            ret = &quot;The stars within the radius: &quot; + coms[1] + &quot; are&quot;;</span>
<span class="nc" id="L266">            ret += &quot;&lt;br&gt; &lt;br&gt;&quot;;</span>
<span class="nc" id="L267">            ret += &quot;&lt;table id=\&quot;table\&quot;&gt;&quot;</span>
              + &quot;&lt;tr&gt; &lt;th&gt; Match # &lt;/th&gt; &lt;th&gt; Name &lt;/th&gt;&quot;
              + &quot;&lt;th&gt; ID &lt;/th&gt; &lt;th&gt; X &lt;/th&gt; &lt;th&gt; Y &lt;/th&gt; &lt;th&gt; Z &lt;/th&gt; &lt;/tr&gt;&quot;;
<span class="nc bnc" id="L270" title="All 2 branches missed.">            for (int i = 0; i &lt; stars.size(); i++) {</span>
<span class="nc" id="L271">              Star curr = stars.get(i);</span>
<span class="nc" id="L272">              ret += &quot;&lt;tr&gt;&lt;td&gt;&quot; + Integer.toString(i + 1) + &quot;&lt;/td&gt;&quot; + &quot;&lt;td&gt;&quot; + curr.getName()</span>
<span class="nc" id="L273">                + &quot;&lt;/td&gt;&quot; + &quot;&lt;td&gt;&quot; + curr.getStarID() + &quot;&lt;/td&gt;&quot;</span>
<span class="nc" id="L274">                + &quot;&lt;td&gt;&quot; + curr.getX() + &quot;&lt;/td&gt;&quot;</span>
<span class="nc" id="L275">                + &quot;&lt;td&gt;&quot; + curr.getY() + &quot;&lt;/td&gt;&quot;</span>
<span class="nc" id="L276">                + &quot;&lt;td&gt;&quot; + curr.getZ() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L277">              ret += &quot;&lt;/tr&gt;&quot;;</span>
            }
<span class="nc" id="L279">            ret += &quot;&lt;/table&gt;&quot;;</span>
          } else {
<span class="nc" id="L281">            ret = &quot;No stars found in the search&quot;;</span>
          }
        }
      }
<span class="nc" id="L285">      Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;title&quot;,</span>
          &quot;Stars: Query the database&quot;, &quot;results&quot;, ret);
<span class="nc" id="L287">      return new ModelAndView(variables, &quot;query.ftl&quot;);</span>
    }
  }

  /**
   * Handles the neighbors call on the GUI.
   */
  private static class NeighborsHandler implements TemplateViewRoute {
    @Override
    public ModelAndView handle(Request req, Response res) {
<span class="nc" id="L297">      QueryParamsMap qm = req.queryMap();</span>
<span class="nc" id="L298">      String cmd = qm.value(&quot;text&quot;);</span>
<span class="nc" id="L299">      String ret = &quot;No results to display&quot;;</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">      if (db.getStarList().size() == 0) {</span>
<span class="nc" id="L301">        ret = &quot;Please load a file in the command line&quot;;</span>
<span class="nc bnc" id="L302" title="All 4 branches missed.">      } else if (cmd == null || cmd.equals(&quot;&quot;)) {</span>
<span class="nc" id="L303">        ret = &quot;Please input a valid answer&quot;;</span>
      } else {
<span class="nc" id="L305">        String neighbs = qm.value(&quot;neighbors_switched&quot;);</span>
<span class="nc" id="L306">        String start = &quot;naive_neighbors&quot;;</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">        if (neighbs != null) {</span>
<span class="nc" id="L308">          start = &quot;neighbors&quot;;</span>
        }
<span class="nc" id="L310">        String cmd2 = start.concat(&quot; &quot;).concat(cmd);</span>
<span class="nc" id="L311">        String[] coms = cmd2.split(&quot; &quot;);</span>
<span class="nc" id="L312">        List&lt;Star&gt; stars = db.neighborsRet(cmd2, coms);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (coms[0].toUpperCase().equals(&quot;NAIVE_RADIUS&quot;)</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">            || coms[0].toUpperCase().equals(&quot;RADIUS&quot;)) {</span>
<span class="nc" id="L315">          ret = &quot;Please use the radius box for this action&quot;;</span>
        } else {
<span class="nc bnc" id="L317" title="All 4 branches missed.">          if (stars != null &amp;&amp; !stars.isEmpty()) {</span>
<span class="nc" id="L318">            ret = &quot;The &quot; + Integer.toString(stars.size()) + &quot; nearest neighbors are:&quot;;</span>
            //
<span class="nc" id="L320">            ret += &quot;&lt;br&gt; &lt;br&gt;&quot;;</span>
<span class="nc" id="L321">            ret += &quot;&lt;table id=\&quot;table\&quot;&gt;&quot;</span>
              + &quot;&lt;tr&gt; &lt;th&gt; Match # &lt;/th&gt; &lt;th&gt; Name &lt;/th&gt;&quot;
              + &quot;&lt;th&gt; ID &lt;/th&gt; &lt;th&gt; X &lt;/th&gt; &lt;th&gt; Y &lt;/th&gt; &lt;th&gt; Z &lt;/th&gt; &lt;/tr&gt;&quot;;
<span class="nc bnc" id="L324" title="All 2 branches missed.">            for (int i = 0; i &lt; stars.size(); i++) {</span>
<span class="nc" id="L325">              Star curr = stars.get(i);</span>
<span class="nc" id="L326">              ret += &quot;&lt;tr&gt;&lt;td&gt;&quot; + Integer.toString(i + 1) + &quot;&lt;/td&gt;&quot;</span>
<span class="nc" id="L327">                + &quot;&lt;td&gt;&quot; + curr.getName() + &quot;&lt;/td&gt;&quot;</span>
<span class="nc" id="L328">                + &quot;&lt;td&gt;&quot; + curr.getStarID() + &quot;&lt;/td&gt;&quot;</span>
<span class="nc" id="L329">                + &quot;&lt;td&gt;&quot; + curr.getX() + &quot;&lt;/td&gt;&quot; + &quot;&lt;td&gt;&quot; + curr.getY()</span>
<span class="nc" id="L330">                + &quot;&lt;/td&gt;&quot; + &quot;&lt;td&gt;&quot; + curr.getZ() + &quot;&lt;/td&gt;&quot;;</span>
<span class="nc" id="L331">              ret += &quot;&lt;/tr&gt;&quot;;</span>
            }
<span class="nc" id="L333">            ret += &quot;&lt;/table&gt;&quot;;</span>
          } else {
<span class="nc" id="L335">            ret = &quot;No stars found in the search&quot;;</span>
          }
        }
      }
<span class="nc" id="L339">      Map&lt;String, Object&gt; variables = ImmutableMap.of(&quot;title&quot;,</span>
          &quot;Stars: Query the database&quot;, &quot;results&quot;, ret);
<span class="nc" id="L341">      return new ModelAndView(variables, &quot;query.ftl&quot;);</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>